# MyLukeAI MVP ê¸°ëŠ¥ ëª…ì„¸ì„œ (Functional Specification)

**ë¬¸ì„œ ë²„ì „**: v1.2  
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-01-XX  
**ì‘ì„±ì**: Technical Product Manager  
**ëŒ€ìƒ ë…ì**: ê°œë°œì (1ì¸ ê°œë°œ í™˜ê²½)

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| v1.0 | 2025-01-XX | ì´ˆê¸° ì‘ì„± (Supabase ê¸°ë°˜) |
| v1.1 | 2025-01-XX | DB ì¸í”„ë¼ ì „ëµ ë³€ê²½: Supabase â†’ PostgreSQL + Prisma |
| v1.2 | 2025-01-XX | ê¸°ìˆ  ë¦¬ë·° ë°˜ì˜: Privacy Mode ì œì™¸, GitHub OAuth ë‹¨ì¼ ì¸ì¦, ìŠ¤í‚¤ë§ˆ ìµœì í™”, UX ë³´ì™„ |

### v1.2 ì£¼ìš” ë³€ê²½ ì‚¬í•­

| í•­ëª© | v1.1 | v1.2 | ë³€ê²½ ì´ìœ  |
|------|------|------|----------|
| **ì¸ì¦** | ì´ë©”ì¼ + OAuth | GitHub OAuth ë‹¨ì¼ | MVP ì¼ì • ì¤€ìˆ˜, êµ¬í˜„ ë³µì¡ë„ ê°ì†Œ |
| **Privacy Mode** | P2 ê¸°ëŠ¥ í¬í•¨ | MVP ë²”ìœ„ ì œì™¸ | êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ, v1.1 ì´í›„ ë¡œë“œë§µìœ¼ë¡œ ì´ë™ |
| **MessageVersion** | ë³„ë„ í…Œì´ë¸” | Message.history (Json) | ìŠ¤í‚¤ë§ˆ ë‹¨ìˆœí™”, ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„  |
| **TokenUsage.userId** | Nullable | Required | Privacy Mode ì œì™¸ë¡œ ì¸í•œ ì •ì±… ëª…í™•í™” |
| **Empty State** | ë¯¸ì •ì˜ | ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ë²„íŠ¼ ë°°ì¹˜ | ì‹ ê·œ ì‚¬ìš©ì UX ê°œì„  |
| **Auth Middleware** | ê°œë³„ ê²€ì¦ | withAuth ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´ | ë³´ì•ˆ ì¼ê´€ì„±, ì½”ë“œ ì¬ì‚¬ìš©ì„± |
| **Model Abstraction** | í•˜ë“œì½”ë”© | AVAILABLE_MODELS ìƒìˆ˜ ê´€ë¦¬ | ë©€í‹° ëª¨ë¸ í™•ì¥ ëŒ€ë¹„ |
| **í‚¤ ê´€ë¦¬ ë°©ì‹** | `.env` íŒŒì¼ ì˜ì¡´ | **ê´€ë¦¬ì UI + DB ì•”í˜¸í™”** | ë³´ì•ˆ ì¼ê´€ì„±, ìš´ì˜ í¸ì˜ì„±, ì¬ì‹œì‘ ì—†ì´ ë°˜ì˜ |

---

## ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ë¹„ì „ ë° í•µì‹¬ ì•„í‚¤í…ì²˜](#1-í”„ë¡œì íŠ¸-ë¹„ì „-ë°-í•µì‹¬-ì•„í‚¤í…ì²˜)
2. [ê¸°ìˆ  ìŠ¤íƒ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ ì •](#2-ê¸°ìˆ -ìŠ¤íƒ-ë°-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì„ ì •)
3. [ê¸°ëŠ¥ ëª…ì„¸ì„œ (Functional Specs)](#3-ê¸°ëŠ¥-ëª…ì„¸ì„œ-functional-specs)
4. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (DB Schema)](#4-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-db-schema)
5. [ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ê°€ì´ë“œ](#5-ì•„í‚¤í…ì²˜-ë°-ê¸°ìˆ -ê°€ì´ë“œ)
6. [í”„ë¡œì íŠ¸ êµ¬ì¡° (Project Structure)](#6-í”„ë¡œì íŠ¸-êµ¬ì¡°-project-structure)
7. [ê°œë°œ ë¡œë“œë§µ (Phase 1: MVP)](#7-ê°œë°œ-ë¡œë“œë§µ-phase-1-mvp)
8. [Post-MVP ë¡œë“œë§µ](#8-post-mvp-ë¡œë“œë§µ)

---

## 1. í”„ë¡œì íŠ¸ ë¹„ì „ ë° í•µì‹¬ ì•„í‚¤í…ì²˜

### 1.1 í”„ë¡œì íŠ¸ ë¹„ì „

**MyLukeAI**ëŠ” Open WebUI ìŠ¤íƒ€ì¼ì˜ ëª¨ë˜ AI ì±„íŒ… í”Œë«í¼ìœ¼ë¡œ, ë‹¤ìŒ í•µì‹¬ ê°€ì¹˜ë¥¼ ì¶”êµ¬í•œë‹¤:

| ê°€ì¹˜ | ì •ì˜ | MVP êµ¬í˜„ ë²”ìœ„ |
|------|------|--------------|
| **ì†ë„** | ë¹ ë¥¸ ì´ˆê¸° ë¡œë”©, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ | ì™„ì „ êµ¬í˜„ |
| **ìœ ì—°ì„±** | ë‹¤ì–‘í•œ AI ëª¨ë¸ ì§€ì›, ë°°í¬ í™˜ê²½ ì„ íƒ | Self-host Ready |
| **í”„ë¼ì´ë²„ì‹œ** | ì‚¬ìš©ì ë°ì´í„° ë³´í˜¸ ì˜µì…˜ | âš ï¸ **v1.1 ì´í›„ êµ¬í˜„ ì˜ˆì •** |

### 1.2 ì•„í‚¤í…ì²˜ ì •ì±… (Architecture Decision Records)

#### ADR-001: ë°°í¬ ëª¨ë“œ ì •ì±…

**ê²°ì •**: MVPëŠ” **Docker/Self-Host Ready** ì•„í‚¤í…ì²˜ë¥¼ ì±„íƒí•œë‹¤. ì´ˆê¸°ë¶€í„° PostgreSQLê³¼ Prisma ORMì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ í™˜ê²½ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ” ìœ ì—°í•œ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•œë‹¤.

| ë°°í¬ ëª¨ë“œ | MVP ì§€ì› | ì„¤ëª… |
|-----------|----------|------|
| **Self-Hosting (Docker + PostgreSQL)** | âœ… ì™„ì „ ì§€ì› | ê¸°ë³¸ ë°°í¬ ë°©ì‹. Vercel + ì™¸ë¶€ PostgreSQL ë˜ëŠ” Docker Composeë¡œ ë°°í¬ |
| **Cloud Managed DB** | âœ… ì™„ì „ ì§€ì› | Railway, Neon, Supabase PostgreSQL ë“± ê´€ë¦¬í˜• PostgreSQL í˜¸í™˜ |

**ê·¼ê±°**: ì´ˆê¸°ë¶€í„° ë°ì´í„° ë…ë¦½ì„±ê³¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ìš©ì´ì„±ì„ í™•ë³´í•˜ê¸° ìœ„í•´ PostgreSQLê³¼ Prismaë¥¼ ì±„íƒí•œë‹¤. íŠ¹ì • BaaS ë²¤ë”ì— ì¢…ì†ë˜ì§€ ì•ŠìŒìœ¼ë¡œì¨, í–¥í›„ ì¸í”„ë¼ í™•ì¥ì´ë‚˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ê¸°ìˆ  ë¶€ì±„ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆë‹¤.

#### ADR-002: Privacy Mode ì •ì±… (v1.1 ì´í›„ êµ¬í˜„)

> âš ï¸ **MVP ë²”ìœ„ ì œì™¸**: Privacy ModeëŠ” êµ¬í˜„ ë³µì¡ë„ê°€ ë†’ì•„ MVPì—ì„œ ì œì™¸í•œë‹¤.

**Post-MVP êµ¬í˜„ ê³„íš**:
- IndexedDB ê¸°ë°˜ ë¡œì»¬ ë©”ì‹œì§€ ì €ì¥
- ì„œë²„ëŠ” ìµëª…í™”ëœ í† í° ì‚¬ìš©ëŸ‰ë§Œ ìˆ˜ì§‘
- ìƒì„¸ ì„¤ê³„ëŠ” v1.1 ëª…ì„¸ì„œì—ì„œ ë³„ë„ ì •ì˜

#### ADR-003: ì±„íŒ… ë¶„ê¸°(Branching) ì œì™¸

**ê²°ì •**: MVPì—ì„œ ì±„íŒ… ë¶„ê¸° ê¸°ëŠ¥ì„ **ì œì™¸**í•˜ê³ , **"ì¬ìƒì„±(Regenerate)"** ë²„íŠ¼ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤.

**ëŒ€ì²´ êµ¬í˜„**:
- ì‚¬ìš©ìê°€ AI ì‘ë‹µì— ë¶ˆë§Œì¡± ì‹œ "ì¬ìƒì„±" ë²„íŠ¼ í´ë¦­
- ë™ì¼ ë©”ì‹œì§€ì— ëŒ€í•œ ì´ì „ ì‘ë‹µë“¤ì€ `Message.history` í•„ë“œ(Json)ì— ì €ì¥
- UIì—ì„œ "ì´ì „ ë²„ì „ ë³´ê¸°" ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥
- íŠ¸ë¦¬ êµ¬ì¡°ê°€ ì•„ë‹Œ **ì„ í˜• ë²„ì „ ê´€ë¦¬**ë¡œ ë³µì¡ë„ ìµœì†Œí™”

#### ADR-004: ì¸ì¦ ì „ëµ (GitHub OAuth ë‹¨ì¼ ì¸ì¦)

**ê²°ì •**: MVPëŠ” **GitHub OAuth ë‹¨ì¼ ì¸ì¦**ë§Œ ì§€ì›í•œë‹¤.

| í•­ëª© | ê²°ì • | ì´ìœ  |
|------|------|------|
| GitHub OAuth | âœ… í¬í•¨ | ê°œë°œì ëŒ€ìƒ MVP, ë¹ ë¥¸ êµ¬í˜„ |
| ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ | âŒ ì œì™¸ | ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, ì´ë©”ì¼ ì¸ì¦ ë“± ì¶”ê°€ ë³µì¡ë„ |
| Google OAuth | âŒ ì œì™¸ | MVP ì´í›„ ìš°ì„ ìˆœìœ„ í‰ê°€ |

**ê·¼ê±°**: 1ì¸ ê°œë°œìê°€ 2ì£¼ ì•ˆì— ì™„ì„±í•  ìˆ˜ ìˆëŠ” í˜„ì‹¤ì ì¸ ë²”ìœ„ë¥¼ ê³ ë ¤í•˜ì—¬, ì¸ì¦ ì„¤ì • ì‹œê°„ì„ ìµœì†Œí™”í•œë‹¤. GitHub OAuthëŠ” ê°œë°œì íƒ€ê²Ÿ ì‚¬ìš©ìì—ê²Œ ì¹œìˆ™í•˜ë©°, NextAuth.jsì—ì„œ ê°€ì¥ ê°„ë‹¨í•˜ê²Œ ì„¤ì • ê°€ëŠ¥í•˜ë‹¤.

---

## 2. ê¸°ìˆ  ìŠ¤íƒ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ ì •

### 2.1 Core Stack

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ë²„ì „ | ì„ ì • ì´ìœ  |
|----------|------|------|-----------|
| **Framework** | Next.js (App Router) | 14.x | Server Components, Streaming ì§€ì› |
| **Language** | TypeScript | 5.x | íƒ€ì… ì•ˆì „ì„±, AI SDK í˜¸í™˜ |
| **Styling** | Tailwind CSS | 3.4+ | ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘, JIT ì»´íŒŒì¼ |
| **UI Components** | shadcn/ui | latest | ì»¤ìŠ¤í„°ë§ˆì´ì§• ìš©ì´, ë²ˆë“¤ ìµœì í™” |
| **Icons** | Lucide React | latest | ì¼ê´€ëœ ë””ìì¸, Tree-shaking |

### 2.2 AI & Data

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ë²„ì „ | ì„ ì • ì´ìœ  |
|----------|------|------|-----------|
| **AI SDK** | Vercel AI SDK | 3.x | ë©€í‹° LLM, ìŠ¤íŠ¸ë¦¬ë°, Edge ìµœì í™” |
| **State** | Zustand | 4.x | ê²½ëŸ‰, ìŠ¤íŠ¸ë¦¬ë° ìƒíƒœ ê´€ë¦¬ ìµœì  |
| **Database** | PostgreSQL | 15+ | ì—…ê³„ í‘œì¤€ RDBMS, í™•ì¥ì„±, ë²¤ë” ë…ë¦½ì„± |
| **ORM** | Prisma | 5.x | íƒ€ì… ì•ˆì „ì„±, ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬, ì§ê´€ì  API |
| **Auth** | NextAuth.js (Auth.js) | 5.x | Next.js ë„¤ì´í‹°ë¸Œ í†µí•©, GitHub OAuth |
| **Token Counter** | js-tiktoken | 1.x | í´ë¼ì´ì–¸íŠ¸ í† í° ê³„ì‚° |

### 2.3 Dev Tools

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ìš©ë„ |
|----------|------|------|
| **Linting** | Biome | ESLint + Prettier ëŒ€ì²´ (ì†ë„ í–¥ìƒ) |
| **Testing** | Vitest + Playwright | ë‹¨ìœ„/E2E í…ŒìŠ¤íŠ¸ |
| **Theme** | next-themes | ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ |
| **Command Palette** | cmdk | Slash Command, ë‹¨ì¶•í‚¤ UI |
| **Markdown** | react-markdown + rehype-highlight | ì½”ë“œ ë¸”ë¡ ë Œë”ë§ |

### 2.4 íŒ¨í‚¤ì§€ ì„¤ì¹˜ ëª…ë ¹ì–´

```bash
# Core
npx create-next-app@14 mylukeai --typescript --tailwind --app --src-dir

# UI
npx shadcn-ui@latest init
npm install lucide-react next-themes cmdk

# AI & State
npm install ai @ai-sdk/openai zustand

# Database (PostgreSQL + Prisma)
npm install @prisma/client
npm install -D prisma

# Auth (GitHub OAuth ì „ìš©)
npm install next-auth@beta @auth/prisma-adapter

# Utils
npm install react-markdown rehype-highlight js-tiktoken

# Dev
npm install -D @biomejs/biome vitest @playwright/test
```

**Prisma ì´ˆê¸° ì„¤ì •**:
```bash
# Prisma ì´ˆê¸°í™” (PostgreSQL)
npx prisma init --datasource-provider postgresql

# ìŠ¤í‚¤ë§ˆ ì‘ì„± í›„ ë§ˆì´ê·¸ë ˆì´ì…˜
npx prisma migrate dev --name init

# Prisma Client ìƒì„±
npx prisma generate
```

---

## 3. ê¸°ëŠ¥ ëª…ì„¸ì„œ (Functional Specs)

### 3.1 ê¸°ëŠ¥ ìš°ì„ ìˆœìœ„ ë§¤íŠ¸ë¦­ìŠ¤ (v1.2 ìˆ˜ì •)

| ìš°ì„ ìˆœìœ„ | ê¸°ëŠ¥ | ì˜ˆìƒ ê³µìˆ˜ | ìƒíƒœ |
|----------|------|----------|------|
| **P0** | ê¸°ë³¸ ì±„íŒ… + ìŠ¤íŠ¸ë¦¬ë° | 2ì¼ | MVP í¬í•¨ |
| **P0** | Markdown/Code ë Œë”ë§ | 0.5ì¼ | MVP í¬í•¨ |
| **P0** | ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ | 0.5ì¼ | MVP í¬í•¨ |
| **P0** | ì—ëŸ¬/ë¡œë”© ìƒíƒœ ì²˜ë¦¬ | 1ì¼ | MVP í¬í•¨ |
| **P0** | ì±„íŒ… íˆìŠ¤í† ë¦¬ (ì‚¬ì´ë“œë°”) | 1ì¼ | MVP í¬í•¨ |
| **P0** | GitHub OAuth ì¸ì¦ | 0.5ì¼ | MVP í¬í•¨ |
| **P0** | Empty State (ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸) | 0.5ì¼ | MVP í¬í•¨ (ì‹ ê·œ) |
| **P1** | ì‘ë‹µ ì¬ìƒì„± (Regenerate) | 1ì¼ | MVP í¬í•¨ |
| **P1** | í† í° ì‚¬ìš©ëŸ‰ í‘œì‹œ (ê°œì„ ) | 0.5ì¼ | MVP í¬í•¨ |
| **P1** | í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ | 0.5ì¼ | MVP í¬í•¨ |
| **P1** | ëŒ€í™” ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° | 1ì¼ | MVP í¬í•¨ |
| **P1** | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§• | 0.5ì¼ | MVP í¬í•¨ |
| ~~P2~~ | ~~Privacy Mode~~ | ~~2ì¼~~ | âŒ **MVP ì œì™¸** |
| **P2** | AI ëª¨ë¸ ì…€ë ‰í„° | 0.5ì¼ | MVP í¬í•¨ (ê°„ì†Œí™”) |

---

### 3.2 [P0] ê¸°ë³¸ ì±„íŒ… + ìŠ¤íŠ¸ë¦¬ë°

#### User Story
> ì‚¬ìš©ìë¡œì„œ, ì…ë ¥ì°½ì— ì§ˆë¬¸ì„ ì‘ì„±í•˜ê³  ì „ì†¡í•˜ë©´ AIì˜ ë‹µë³€ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ íƒ€ì´í•‘ë˜ë“¯ í‘œì‹œë˜ì–´ì•¼ í•œë‹¤.

#### UI/UX ìƒì„¸

**ì •ìƒ íë¦„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ì‚¬ì´ë“œë°”]  â”‚        [ì±„íŒ… ì˜ì—­]                â”‚
â”‚             â”‚                                   â”‚
â”‚  + ìƒˆ ì±„íŒ…   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚             â”‚   â”‚ ğŸ‘¤ ì‚¬ìš©ì ë©”ì‹œì§€          â”‚    â”‚
â”‚  ğŸ“ ì±„íŒ…1    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  ğŸ“ ì±„íŒ…2    â”‚                                   â”‚
â”‚             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚             â”‚   â”‚ ğŸ¤– AI ì‘ë‹µ (ìŠ¤íŠ¸ë¦¬ë° ì¤‘...) â”‚   â”‚
â”‚             â”‚   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚    â”‚
â”‚             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚             â”‚                                   â”‚
â”‚             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚             â”‚   â”‚ [ì…ë ¥ì°½]    [â–  ìƒì„± ì¤‘ì§€] â”‚    â”‚
â”‚             â”‚   â”‚ ğŸ’¬ ë‚¨ì€ ëŒ€í™”ëŸ‰: 97% â“˜     â”‚    â”‚
â”‚             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒíƒœë³„ UI**:

| ìƒíƒœ | UI í‘œí˜„ |
|------|---------|
| **Idle** | ì…ë ¥ì°½ í™œì„±í™”, ì „ì†¡ ë²„íŠ¼ enabled (SendHorizontal ì•„ì´ì½˜) |
| **Streaming** | ì „ì†¡ ë²„íŠ¼ â†’ **"â–  ìƒì„± ì¤‘ì§€"** ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ (Square ì•„ì´ì½˜), ì…ë ¥ì°½ disabled |
| **Loading (ì´ˆê¸°)** | AI ë²„ë¸”ì— 3-dot í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ |
| **Complete** | ì…ë ¥ì°½ ì¬í™œì„±í™”, AI ë²„ë¸” í•˜ë‹¨ì— "ë³µì‚¬" / "ì¬ìƒì„±" ë²„íŠ¼ í‘œì‹œ |

**"Stop Generating" ë²„íŠ¼ ìƒì„¸ ë™ì‘**:

| í•­ëª© | ë™ì‘ |
|------|------|
| **í´ë¦­ ì‹œ** | `AbortController.abort()` í˜¸ì¶œí•˜ì—¬ ìŠ¤íŠ¸ë¦¼ ì¦‰ì‹œ ì¤‘ë‹¨ |
| **ì¤‘ë‹¨ í›„ ë©”ì‹œì§€** | í˜„ì¬ê¹Œì§€ ìˆ˜ì‹ ëœ ë¶€ë¶„ ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ë³´ì¡´í•˜ì—¬ í‘œì‹œ |
| **UI ìƒíƒœ** | `isStreaming: false`ë¡œ ë³€ê²½, ì…ë ¥ì°½ ì¬í™œì„±í™” |
| **ë©”ì‹œì§€ ì €ì¥** | ë¶€ë¶„ ì‘ë‹µë„ DBì— ì €ì¥ (content í•„ë“œì— í˜„ì¬ê¹Œì§€ ìˆ˜ì‹ ëœ í…ìŠ¤íŠ¸) |
| **ì¬ìƒì„± ê°€ëŠ¥** | ì¤‘ë‹¨ëœ ì‘ë‹µì— ëŒ€í•´ "ì¬ìƒì„±" ë²„íŠ¼ í™œì„±í™” |

**ì—ëŸ¬ ìƒíƒœ UI**:

| ì—ëŸ¬ ìœ í˜• | UI í‘œí˜„ | ì‚¬ìš©ì ì•¡ì…˜ |
|-----------|---------|-------------|
| **Network Error** | í† ìŠ¤íŠ¸: "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”" (ë¹¨ê°„ìƒ‰) | "ì¬ì‹œë„" ë²„íŠ¼ |
| **Rate Limit (429)** | í† ìŠ¤íŠ¸: "ìš”ì²­ í•œë„ ì´ˆê³¼. Nì´ˆ í›„ ì¬ì‹œë„" | ì¹´ìš´íŠ¸ë‹¤ìš´ í›„ ìë™ ì¬í™œì„±í™” |
| **API Error (500)** | AI ë²„ë¸” ë‚´ ì¸ë¼ì¸ ì—ëŸ¬: "ì‘ë‹µ ìƒì„± ì‹¤íŒ¨" | "ì¬ì‹œë„" ë²„íŠ¼ |
| **Context Length** | í† ìŠ¤íŠ¸: "ëŒ€í™”ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ìƒˆ ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”" | "ìƒˆ ì±„íŒ…" ë²„íŠ¼ |

#### ê¸°ìˆ ì  êµ¬í˜„ í¬ì¸íŠ¸

**API Route**: `app/api/chat/route.ts`

```typescript
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';
import { withAuth } from '@/lib/auth/middleware';
import { AVAILABLE_MODELS, DEFAULT_MODEL } from '@/lib/constants/models';

export const POST = withAuth(async (req: Request, userId: string) => {
  const { messages, model = DEFAULT_MODEL } = await req.json();

  // ëª¨ë¸ ìœ íš¨ì„± ê²€ì‚¬
  if (!AVAILABLE_MODELS.find(m => m.id === model)) {
    return new Response('Invalid model', { status: 400 });
  }

  const result = await streamText({
    model: openai(model),
    messages,
    abortSignal: req.signal, // Stop Generating ì§€ì›
    onFinish: async ({ usage }) => {
      // í† í° ì‚¬ìš©ëŸ‰ DB ì €ì¥ (ë¹„ë™ê¸°)
      await logTokenUsage(userId, model, usage);
    },
  });

  return result.toDataStreamResponse();
});
```

**Zustand Store**: `stores/chatStore.ts`

```typescript
interface ChatState {
  messages: Message[];
  isStreaming: boolean;
  error: ChatError | null;
  abortController: AbortController | null;
  
  // Actions
  sendMessage: (content: string) => Promise<void>;
  stopStreaming: () => void;
  regenerateLastResponse: () => Promise<void>;
  clearError: () => void;
}

interface ChatError {
  type: 'network' | 'rateLimit' | 'apiError' | 'contextLength';
  message: string;
  retryAfter?: number; // Rate Limit ì‹œ ì´ˆ ë‹¨ìœ„
}

// stopStreaming êµ¬í˜„
stopStreaming: () => {
  const { abortController } = get();
  if (abortController) {
    abortController.abort();
    set({ isStreaming: false, abortController: null });
  }
}
```

**ì…ë ¥ ì²˜ë¦¬ ë¡œì§**:
- `Enter`: ë©”ì‹œì§€ ì „ì†¡
- `Shift + Enter`: ì¤„ë°”ê¿ˆ ì‚½ì…
- ë¹ˆ ë©”ì‹œì§€ ì „ì†¡ ë°©ì§€ (trim í›„ ë¹ˆ ë¬¸ìì—´ ì²´í¬)

---

### 3.3 [P0] Empty State (ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸)

#### User Story
> ì‹ ê·œ ì‚¬ìš©ìë¡œì„œ, ì±„íŒ… ì‹œì‘ ì „ ë¹ˆ í™”ë©´ì—ì„œ ë¬´ì—‡ì„ ë¬¼ì–´ë³¼ ìˆ˜ ìˆëŠ”ì§€ ì˜ˆì‹œë¥¼ ë³´ê³  ì‰½ê²Œ ì‹œì‘í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

#### UI/UX ìƒì„¸

**Empty State ë ˆì´ì•„ì›ƒ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚           ğŸ¤– MyLukeAI                           â”‚
â”‚                                                 â”‚
â”‚       ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”                         â”‚
â”‚                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ğŸ’¡ ì˜¤ëŠ˜ ë­ ë¨¹ì„ì§€ â”‚  â”‚ ğŸ“ ì´ë©”ì¼ ì‘ì„±ì„  â”‚   â”‚
â”‚   â”‚    ì¶”ì²œí•´ì¤˜      â”‚  â”‚    ë„ì™€ì¤˜        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ğŸ’» Reactì™€ Vueì˜ â”‚  â”‚ ğŸ“– ì–‘ìì—­í•™ì„     â”‚   â”‚
â”‚   â”‚    ì°¨ì´ì  ì„¤ëª…    â”‚  â”‚    ì‰½ê²Œ ì„¤ëª…í•´ì¤˜  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ [ì…ë ¥ì°½]                        [ì „ì†¡] â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ë²„íŠ¼ ì‚¬ì–‘**:

| í•­ëª© | ê°’ |
|------|-----|
| ë²„íŠ¼ ê°œìˆ˜ | 4ê°œ (2x2 ê·¸ë¦¬ë“œ) |
| ë²„íŠ¼ ìŠ¤íƒ€ì¼ | `variant="outline"`, hover ì‹œ `bg-accent` |
| ì•„ì´ì½˜ | ê° í”„ë¡¬í”„íŠ¸ ì„±ê²©ì— ë§ëŠ” Lucide ì•„ì´ì½˜ (Lightbulb, FileText, Code, BookOpen) |
| í´ë¦­ ë™ì‘ | í•´ë‹¹ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ì°½ì— ìë™ ì…ë ¥ í›„ **ì¦‰ì‹œ ì „ì†¡** |
| ë°˜ì‘í˜• | ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´ ìŠ¤íƒ ë ˆì´ì•„ì›ƒ |

**ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ëª©ë¡** (`lib/constants/prompts.ts`):

```typescript
export const EXAMPLE_PROMPTS = [
  { icon: 'Lightbulb', text: 'ì˜¤ëŠ˜ ë­ ë¨¹ì„ì§€ ì¶”ì²œí•´ì¤˜' },
  { icon: 'FileText', text: 'ì´ë©”ì¼ ì‘ì„±ì„ ë„ì™€ì¤˜' },
  { icon: 'Code', text: 'Reactì™€ Vueì˜ ì°¨ì´ì ì„ ì„¤ëª…í•´ì¤˜' },
  { icon: 'BookOpen', text: 'ì–‘ìì—­í•™ì„ ì‰½ê²Œ ì„¤ëª…í•´ì¤˜' },
] as const;
```

**ì»´í¬ë„ŒíŠ¸**: `components/chat/EmptyState.tsx`

```typescript
interface EmptyStateProps {
  onPromptClick: (prompt: string) => void;
}

export function EmptyState({ onPromptClick }: EmptyStateProps) {
  return (
    <div className="flex flex-col items-center justify-center h-full gap-8">
      <div className="text-center">
        <Bot className="h-12 w-12 mx-auto mb-4 text-primary" />
        <h1 className="text-2xl font-semibold">MyLukeAI</h1>
        <p className="text-muted-foreground mt-2">ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”</p>
      </div>
      
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-md">
        {EXAMPLE_PROMPTS.map((prompt) => (
          <Button
            key={prompt.text}
            variant="outline"
            className="h-auto py-3 px-4 justify-start text-left"
            onClick={() => onPromptClick(prompt.text)}
          >
            <IconComponent name={prompt.icon} className="h-4 w-4 mr-2 shrink-0" />
            <span className="text-sm">{prompt.text}</span>
          </Button>
        ))}
      </div>
    </div>
  );
}
```

---

### 3.4 [P0] ì—ëŸ¬/ë¡œë”© ìƒíƒœ ì²˜ë¦¬

#### User Story
> ì‚¬ìš©ìë¡œì„œ, AI ì‘ë‹µ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë¬´ì—‡ì´ ì˜ëª»ë˜ì—ˆëŠ”ì§€ ì´í•´í•˜ê³ , ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ëª…í™•í•œ ì•ˆë‚´ë¥¼ ë°›ì•„ì•¼ í•œë‹¤.

#### ì—ëŸ¬ ì²˜ë¦¬ ë§¤íŠ¸ë¦­ìŠ¤

| HTTP Status | ì›ì¸ | ì‚¬ìš©ì ë©”ì‹œì§€ | ìë™ ì¬ì‹œë„ |
|-------------|------|--------------|-------------|
| 400 | ì˜ëª»ëœ ìš”ì²­ | "ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" | âŒ |
| 401 | ì¸ì¦ ì˜¤ë¥˜ | "ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”" | âŒ (ë¡œê·¸ì¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸) |
| 403 | ê¶Œí•œ ì—†ìŒ | "ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" | âŒ |
| 429 | Rate Limit | "ìš”ì²­ í•œë„ ì´ˆê³¼ (Nì´ˆ í›„ ì¬ì‹œë„)" | âœ… (ëŒ€ê¸° í›„) |
| 500 | ì„œë²„ ì˜¤ë¥˜ | "ì¼ì‹œì ì¸ ì˜¤ë¥˜ì…ë‹ˆë‹¤" | âœ… (ìµœëŒ€ 3íšŒ) |
| Network | ì—°ê²° ëŠê¹€ | "ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”" | âœ… (ì—°ê²° ë³µêµ¬ ì‹œ) |

#### ê¸°ìˆ ì  êµ¬í˜„: ì—ëŸ¬ ë°”ìš´ë”ë¦¬

```typescript
// components/shared/ErrorBoundary.tsx
export function ChatErrorFallback({ error, resetError }: ErrorFallbackProps) {
  return (
    <div className="flex flex-col items-center gap-4 p-6">
      <AlertCircle className="h-12 w-12 text-destructive" />
      <p className="text-center text-muted-foreground">{error.message}</p>
      <Button onClick={resetError}>ë‹¤ì‹œ ì‹œë„</Button>
    </div>
  );
}
```

---

### 3.5 [P1] í† í° ì‚¬ìš©ëŸ‰ í‘œì‹œ (ê°œì„ )

#### User Story
> ì‚¬ìš©ìë¡œì„œ, í˜„ì¬ ëŒ€í™”ê°€ ëª¨ë¸ì˜ ì»¨í…ìŠ¤íŠ¸ í•œê³„ì— ì–¼ë§ˆë‚˜ ê°€ê¹Œìš´ì§€ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

#### UI/UX ìƒì„¸

**í† í° ì¹´ìš´í„° í‘œì‹œ í˜•ì‹**:

| ì‚¬ìš©ëŸ‰ | í‘œì‹œ | ìƒ‰ìƒ | íˆ´íŒ |
|--------|------|------|------|
| 0-70% | "ğŸ’¬ ë‚¨ì€ ëŒ€í™”ëŸ‰: ì¶©ë¶„" | `text-muted-foreground` | "í˜„ì¬ {used}/{max} í† í° ì‚¬ìš© ì¤‘" |
| 70-90% | "ğŸ’¬ ë‚¨ì€ ëŒ€í™”ëŸ‰: ë³´í†µ" | `text-yellow-500` | "ëŒ€í™”ê°€ ê¸¸ì–´ì§€ê³  ìˆì–´ìš”. {remaining} í† í° ë‚¨ìŒ" |
| 90-100% | "ğŸ’¬ ë‚¨ì€ ëŒ€í™”ëŸ‰: ë¶€ì¡±" | `text-destructive` | "ê³§ ìƒˆ ì±„íŒ…ì´ í•„ìš”í•´ìš”. {remaining} í† í° ë‚¨ìŒ" |

**ì»´í¬ë„ŒíŠ¸**: `components/chat/TokenCounter.tsx`

```typescript
interface TokenCounterProps {
  usedTokens: number;
  maxTokens: number; // ëª¨ë¸ë³„ ìƒì´: gpt-4o-mini = 128000
}

export function TokenCounter({ usedTokens, maxTokens }: TokenCounterProps) {
  const percentage = (usedTokens / maxTokens) * 100;
  const remaining = maxTokens - usedTokens;
  
  const status = useMemo(() => {
    if (percentage < 70) return { label: 'ì¶©ë¶„', color: 'text-muted-foreground' };
    if (percentage < 90) return { label: 'ë³´í†µ', color: 'text-yellow-500' };
    return { label: 'ë¶€ì¡±', color: 'text-destructive' };
  }, [percentage]);
  
  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <div className={cn('flex items-center gap-1 text-xs', status.color)}>
            <MessageSquare className="h-3 w-3" />
            <span>ë‚¨ì€ ëŒ€í™”ëŸ‰: {status.label}</span>
            <Info className="h-3 w-3" />
          </div>
        </TooltipTrigger>
        <TooltipContent>
          <p>í˜„ì¬ {usedTokens.toLocaleString()} / {maxTokens.toLocaleString()} í† í° ì‚¬ìš© ì¤‘</p>
          <p>{remaining.toLocaleString()} í† í° ë‚¨ìŒ</p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
```

---

### 3.6 [P2] AI ëª¨ë¸ ì…€ë ‰í„° (ê°„ì†Œí™”)

#### User Story
> ì‚¬ìš©ìë¡œì„œ, ëŒ€í™” ì‹œ ì‚¬ìš©í•  AI ëª¨ë¸ì„ ì„ íƒí•  ìˆ˜ ìˆì–´ì•¼ í•˜ë©°, ê° ëª¨ë¸ì˜ íŠ¹ì„±ì„ ì´í•´í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

#### UI/UX ìƒì„¸

**ëª¨ë¸ ì…€ë ‰í„° ìœ„ì¹˜**: ì…ë ¥ì°½ ì¢Œì¸¡ ë˜ëŠ” í—¤ë” ì˜ì—­

**ì»´í¬ë„ŒíŠ¸**: `components/chat/ModelSelector.tsx`

```typescript
import { AVAILABLE_MODELS } from '@/lib/constants/models';
```typescript
export function ModelSelector({ value, onChange }: ModelSelectorProps) {
  return (
    <Select value={value} onValueChange={onChange}>
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="ëª¨ë¸ ì„ íƒ" />
      </SelectTrigger>
      <SelectContent>
        {AVAILABLE_MODELS.map((model) => (
          <SelectItem key={model.id} value={model.id}>
            <div className="flex items-center gap-2">
              <span>{model.name}</span>
              {model.badge && (
                <Badge variant="secondary" className="text-xs">
                  {model.badge}
                </Badge>
              )}
            </div>
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

---

### 3.7 [P0] ê´€ë¦¬ì í‚¤ ê´€ë¦¬ (OpenWebUI ìœ ì‚¬)

#### User Story
> ì‚¬ì´íŠ¸ ê´€ë¦¬ìã¨ã—ã¦, ì›¹ UIì—ì„œ ì—¬ëŸ¬ LLM ì œê³µìì˜ API í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒí•˜ê³ , ì‚¬ìš© ë‚´ì—­ê³¼ ì ‘ê·¼ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. í‚¤ ë³€ê²½ì€ ì‹œìŠ¤í…œ ì¬ì‹œì‘ ì—†ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì–´ì•¼ í•œë‹¤.

#### UI/UX ìƒì„¸ (OpenWebUI ìœ ì‚¬ ì¸í„°í˜ì´ìŠ¤)

**í˜ì´ì§€ êµ¬ì„±**:
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ: í‚¤ ìš”ì•½ ì¹´ë“œ(í™œì„± ìˆ˜, ì‚¬ìš©ëŸ‰, ë§ˆì§€ë§‰ ë³€ê²½), ìµœê·¼ ê°ì‚¬ ë¡œê·¸
- í‚¤ ê´€ë¦¬ í˜ì´ì§€: ëª©ë¡/ê²€ìƒ‰/ì •ë ¬, ìƒì„±/ìˆ˜ì •/ì‚­ì œ, í™œì„±/ë¹„í™œì„± í† ê¸€, ë§Œë£Œì¼, ì„¤ëª…
- ì‚¬ìš© ë‚´ì—­ í˜ì´ì§€: ëª¨ë¸/ì—”ë“œí¬ì¸íŠ¸ë³„ ì§‘ê³„, ìµœê·¼ ì‚¬ìš©, í•„í„°(ê¸°ê°„/ëª¨ë¸/í‚¤)
- ê°ì‚¬ ë¡œê·¸ í˜ì´ì§€: ì•¡ì…˜(ìƒì„±/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ), ì£¼ì²´, ëŒ€ìƒ, ë³€ê²½ ì „/í›„

**í‚¤ ëª©ë¡ í–‰ êµ¬ì„±**:
- ì´ë¦„, ì œê³µì ë°°ì§€(OpenAI/Anthropic/Gemini/OpenRouter), í™œì„± ìƒíƒœ, ë§Œë£Œì¼, ë§ˆì§€ë§‰ ì‚¬ìš©, ìƒì„±ì
- í–‰ ì•¡ì…˜: ìˆ˜ì •, ì‚­ì œ, ë¹„í™œì„±í™”, í…ŒìŠ¤íŠ¸ í˜¸ì¶œ(ê°„ë‹¨í•œ í•‘)
- í‚¤ ê°’ì€ í•­ìƒ ë§ˆìŠ¤í‚¹ ì²˜ë¦¬(`sk-...****`)ë¡œ í‘œì‹œ, ì „ì²´ ê°’ì€ UIì— ë…¸ì¶œí•˜ì§€ ì•ŠìŒ

**ìƒì„±/ìˆ˜ì • í¼**:
- í•„ë“œ: ì´ë¦„, ì œê³µì ì…€ë ‰íŠ¸, API í‚¤ ì…ë ¥, ì„¤ëª…, ë§Œë£Œì¼(ì˜µì…˜), í™œì„± ì—¬ë¶€
- ê²€ì¦: í•„ìˆ˜ í•„ë“œ, ì œê³µìë³„ í‚¤ íŒ¨í„´ ê°„ë‹¨ ê²€ì¦, ë§Œë£Œì¼ ê³¼ê±° ë¶ˆê°€
- ì €ì¥ ì‹œ ì•”í˜¸í™” ì²˜ë¦¬ í›„ DB ì €ì¥, ê°ì‚¬ ë¡œê·¸ ê¸°ë¡

#### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (CRUD/ì¡°íšŒ)
- ìƒì„±(Create): ê´€ë¦¬ìë§Œ ê°€ëŠ¥, ì €ì¥ ì‹œ `encryptedKey` + `iv` + `tag` ì €ì¥, ê°ì‚¬ ë¡œê·¸ ê¸°ë¡
- ìˆ˜ì •(Update): ì´ë¦„/ì„¤ëª…/ë§Œë£Œì¼/í™œì„± ìƒíƒœ ë³€ê²½, í‚¤ êµì²´ ì‹œ ì´ì „ í‚¤ íê¸° ê¸°ë¡
- ì‚­ì œ(Delete): ì†Œí”„íŠ¸ ì‚­ì œ ê¶Œì¥(`deletedAt`) ë˜ëŠ” í•˜ë“œ ì‚­ì œ, ê°ì‚¬ ë¡œê·¸ ê¸°ë¡
- ì¡°íšŒ(Read): ëª©ë¡/ìƒì„¸ ì¡°íšŒ, í‚¤ ê°’ì€ ë³µí˜¸í™”í•˜ì§€ ì•Šê³  ë§ˆìŠ¤í‚¹ëœ ì¼ë¶€ë§Œ í‘œì‹œ
- ì‚¬ìš© ë‚´ì—­(Usage): ì±„íŒ…/ë°±ì—”ë“œ í˜¸ì¶œ ì‹œ ì‚¬ìš©ëœ í‚¤ì™€ ëª¨ë¸, íƒ€ì„ìŠ¤íƒ¬í”„, í˜¸ì¶œ ê²½ë¡œ ì €ì¥
- ì ‘ê·¼ ë¡œê·¸(Access): ê´€ë¦¬ì UI ì ‘ê·¼ ë° ì£¼ìš” ì¡°íšŒ ì•¡ì…˜ ê¸°ë¡(IP/UA í¬í•¨)

#### ê¶Œí•œ ë° ì ‘ê·¼ ì œì–´
- ê´€ë¦¬ì ì „ìš© ë¼ìš°íŠ¸ ê·¸ë£¹: `app/(admin)/...` ë° `app/api/admin/...`
- ë¯¸ë“¤ì›¨ì–´: `withAdmin`, `requireAdmin`ë¡œ ì„¸ì…˜ì˜ `user.role === 'admin'` ê²€ì¦
- RBAC: `User.role` í•„ë“œ ì¶”ê°€(`'admin' | 'user'`), ê¸°ë³¸ì€ `user`
- ëª¨ë“  í‚¤ ê´€ë ¨ APIì— ì¸ì¦/ê¶Œí•œ ê²€ì‚¬ ë° ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ì ìš©

#### ë³´ì•ˆ ìš”êµ¬ì‚¬í•­
- ì €ì¥ ì‹œ ì•”í˜¸í™”: **AES-256-GCM**, í•„ë“œ: `encryptedKey`, `iv`, `tag`
- ì „ì†¡/í‘œì‹œ: í‚¤ ì „ì²´ê°’ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡/ë Œë”ë§í•˜ì§€ ì•ŠìŒ, ì„œë²„ ë‚´ë¶€ ë¡œì§ì—ì„œë§Œ ë³µí˜¸í™”
- ê°ì‚¬ ë¡œê·¸: í‚¤ ì›ë¬¸ ë¯¸í¬í•¨, ë©”íƒ€ë°ì´í„°ë§Œ ê¸°ë¡(ë³€ê²½ ì „/í›„ëŠ” ë§ˆìŠ¤í‚¹)
- í‚¤ ë¡œí…Œì´ì…˜: êµì²´ ì‹œ ì´ì „ í‚¤ ë¹„í™œì„±í™” ë° íê¸° ì‹œê°„ ê¸°ë¡
- êµ¬ì„± í‚¤: ì•”í˜¸í™” í‚¤ëŠ” `API_KEY_ENCRYPTION_KEY` í™˜ê²½ë³€ìˆ˜ë¡œ ì œê³µ, KMS ì—°ê³„ëŠ” Post-MVP

#### ì‹œìŠ¤í…œ ë™ì‘ ë° ì‹¤ì‹œê°„ ë°˜ì˜
- ëŸ°íƒ€ì„ ìºì‹œ: í™œì„± í‚¤ë¥¼ í”„ë¡œë°”ì´ë”ë³„ë¡œ ë©”ëª¨ë¦¬ ìºì‹œ
- ë³€ê²½ ë°˜ì˜: ìƒì„±/ìˆ˜ì •/ì‚­ì œ ì‹œ ìºì‹œ ë¬´íš¨í™” â†’ ë‹¤ìŒ í˜¸ì¶œë¶€í„° ì¦‰ì‹œ ìµœì‹  í‚¤ ì‚¬ìš©
- ì±„íŒ… API ì—°ê³„: `.env` ëŒ€ì‹  DBì—ì„œ í™œì„± í‚¤ ì¡°íšŒí•˜ì—¬ `openai(...)` ë“± SDK ì´ˆê¸°í™”

#### API ë¼ìš°íŠ¸ ê°œìš”
- `POST /api/admin/keys`: í‚¤ ìƒì„±
- `GET /api/admin/keys`: í‚¤ ëª©ë¡ ì¡°íšŒ
- `PATCH /api/admin/keys/:id`: í‚¤ ìˆ˜ì •/í™œì„± í† ê¸€
- `DELETE /api/admin/keys/:id`: í‚¤ ì‚­ì œ
- `GET /api/admin/keys/stats`: ì‚¬ìš©ëŸ‰ ìš”ì•½
- `GET /api/admin/audit-logs`: ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ

#### ì™„ë£Œ ê¸°ì¤€
- ê´€ë¦¬ì UIì—ì„œ í‚¤ CRUD ë° ìƒíƒœ ê´€ë¦¬ ê°€ëŠ¥, í‚¤ ë³€ê²½ì´ ì±„íŒ… ê¸°ëŠ¥ì— ì¦‰ì‹œ ë°˜ì˜
- í‚¤ ì›ë¬¸ì´ UI/ë¡œê·¸/ë„¤íŠ¸ì›Œí¬ì— ë…¸ì¶œë˜ì§€ ì•ŠìŒ
- ì‚¬ìš© ë‚´ì—­/ê°ì‚¬ ë¡œê·¸ê°€ í•„í„°ë§Â·ê²€ìƒ‰ ê°€ëŠ¥

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (DB Schema)

### 4.1 ER ë‹¤ì´ì–´ê·¸ë¨ (v1.2 ìˆ˜ì •)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚       â”‚  conversations   â”‚       â”‚    messages     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚â—€â”€â”€â”   â”‚ id (PK)          â”‚â—€â”€â”€â”   â”‚ id (PK)         â”‚
â”‚ email        â”‚   â””â”€â”€â”€â”‚ userId (FK)      â”‚   â””â”€â”€â”€â”‚ conversationId  â”‚
â”‚ name         â”‚       â”‚ title            â”‚       â”‚ role            â”‚
â”‚ avatarUrl    â”‚       â”‚ model            â”‚       â”‚ content         â”‚
â”‚ preferences  â”‚       â”‚ systemPrompt     â”‚       â”‚ tokens          â”‚
â”‚ createdAt    â”‚       â”‚ createdAt        â”‚       â”‚ history (Json)  â”‚ â† ë²„ì „ ê´€ë¦¬
â”‚ updatedAt    â”‚       â”‚ updatedAt        â”‚       â”‚ context (Json)  â”‚ â† RAG ëŒ€ë¹„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ createdAt       â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                       â”‚   token_usage    â”‚                â”‚
                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
                       â”‚ id (PK)          â”‚                â”‚
                       â”‚ userId (FK) *    â”‚ â† Required (Not Null)
                       â”‚ model            â”‚
                       â”‚ promptTokens     â”‚
                       â”‚ completionTokens â”‚
                       â”‚ createdAt        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**v1.2 ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‚¬í•­**:

| ë³€ê²½ í•­ëª© | v1.1 | v1.2 | ë³€ê²½ ì´ìœ  |
|----------|------|------|----------|
| `message_versions` í…Œì´ë¸” | ë³„ë„ í…Œì´ë¸” | **ì‚­ì œ** | ìŠ¤í‚¤ë§ˆ ë‹¨ìˆœí™” |
| `Message.history` | ì—†ìŒ | Json í•„ë“œ ì¶”ê°€ | ì´ì „ ë²„ì „ì„ ë°°ì—´ë¡œ ê´€ë¦¬ |
| `Message.context` | ì—†ìŒ | Json í•„ë“œ ì¶”ê°€ (optional) | RAG í™•ì¥ì„± ëŒ€ë¹„ |
| `Conversation.isPrivate` | ìˆìŒ | **ì‚­ì œ** | Privacy Mode ì œì™¸ |
| `TokenUsage.userId` | Nullable | **Required** | Privacy Mode ì œì™¸ë¡œ ìµëª… ì¶”ì  ë¶ˆí•„ìš” |
| `TokenUsage.isPrivate` | ìˆìŒ | **ì‚­ì œ** | Privacy Mode ì œì™¸ |

### 4.2 Prisma ìŠ¤í‚¤ë§ˆ (v1.2)

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// NextAuth.js í•„ìˆ˜ ëª¨ë¸
// ============================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  emailVerified DateTime?
  image         String?
  preferences   Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  accounts      Account[]
  sessions      Session[]
  conversations Conversation[]
  tokenUsages   TokenUsage[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ============================================
// ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë¸ (v1.2 ìˆ˜ì •)
// ============================================

model Conversation {
  id           String    @id @default(cuid())
  userId       String
  title        String    @default("New Chat")
  model        String    @default("gpt-4o-mini")
  systemPrompt String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages Message[]

  @@index([userId])
  @@index([updatedAt(sort: Desc)])
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  role           String   // 'user' | 'assistant' | 'system'
  content        String   @db.Text
  tokens         Int?
  
  // v1.2 ì¶”ê°€: ë²„ì „ ê´€ë¦¬ë¥¼ ìœ„í•œ íˆìŠ¤í† ë¦¬ (ë³„ë„ í…Œì´ë¸” ëŒ€ì²´)
  // í˜•ì‹: [{ content: string, createdAt: string }, ...]
  history        Json     @default("[]")
  
  // v1.2 ì¶”ê°€: RAG í™•ì¥ì„± ëŒ€ë¹„ ì»¨í…ìŠ¤íŠ¸ ì €ì¥
  // í˜•ì‹: { sources: [...], embeddings: [...], metadata: {...} }
  context        Json?
  
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
}

model TokenUsage {
  id               String   @id @default(cuid())
  userId           String   // v1.2: Required (Not Null)
  model            String
  promptTokens     Int
  completionTokens Int
  createdAt        DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}
```

### 4.6 í‚¤ ê´€ë¦¬ í…Œì´ë¸” (ì‹ ê·œ)

```prisma
// ê´€ë¦¬ì í‚¤ ê´€ë¦¬ìš© í…Œì´ë¸” (v1.2 í™•ì¥)

model ApiKey {
  id           String   @id @default(cuid())
  name         String
  provider     String   // 'openai' | 'anthropic' | 'gemini' | 'openrouter'
  encryptedKey Bytes    // AES-GCM ì•”í˜¸ë¬¸
  iv           Bytes    // ì´ˆê¸°í™” ë²¡í„°
  tag          Bytes    // ì¸ì¦ íƒœê·¸
  description  String?
  isActive     Boolean  @default(true)
  expiresAt    DateTime?
  lastUsedAt   DateTime?
  usageCount   Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?

  creatorId String
  creator   User     @relation(fields: [creatorId], references: [id], onDelete: SetNull)

  usages ApiKeyUsage[]

  @@index([provider, isActive])
}

model ApiKeyUsage {
  id         String   @id @default(cuid())
  apiKeyId   String
  userId     String?
  model      String
  route      String   // í˜¸ì¶œ ë¼ìš°íŠ¸ ì˜ˆ: "/api/chat"
  createdAt  DateTime @default(now())

  apiKey ApiKey @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)
  user   User?  @relation(fields: [userId], references: [id])

  @@index([apiKeyId])
  @@index([createdAt])
}

model AdminAuditLog {
  id         String   @id @default(cuid())
  actorId    String
  action     String   // 'create' | 'update' | 'delete' | 'read'
  entityType String   // 'ApiKey' | 'ApiKeyUsage'
  entityId   String
  ip         String?
  userAgent  String?
  before     Json?
  after      Json?
  createdAt  DateTime @default(now())

  actor User @relation(fields: [actorId], references: [id])

  @@index([entityType, entityId])
  @@index([createdAt])
}

// RBACì„ ìœ„í•œ ì‚¬ìš©ì ì—­í•  í•„ë“œ ì¶”ê°€ ì˜ˆì‹œ
enum UserRole {
  admin
  user
}

// User ëª¨ë¸ì— í•„ë“œ ì¶”ê°€:
// role UserRole @default(user)
```

### 4.3 Message.history í•„ë“œ ìƒì„¸

**ë°ì´í„° êµ¬ì¡°**:

```typescript
// types/database.ts
interface MessageHistory {
  content: string;      // ì´ì „ ë²„ì „ ë‚´ìš©
  createdAt: string;    // ISO 8601 í˜•ì‹
}

// ì˜ˆì‹œ ë°ì´í„°
const exampleHistory: MessageHistory[] = [
  { content: "ì²« ë²ˆì§¸ ì‘ë‹µ ë‚´ìš©...", createdAt: "2025-01-15T10:30:00Z" },
  { content: "ë‘ ë²ˆì§¸ ì‘ë‹µ ë‚´ìš©...", createdAt: "2025-01-15T10:32:00Z" },
];
```

**ì¬ìƒì„± ì‹œ íˆìŠ¤í† ë¦¬ ê´€ë¦¬ ë¡œì§**:

```typescript
// lib/prisma/queries.ts
export async function regenerateMessage(messageId: string, newContent: string) {
  const message = await prisma.message.findUnique({ where: { id: messageId } });
  if (!message) throw new Error('Message not found');
  
  const history = (message.history as MessageHistory[]) || [];
  
  // í˜„ì¬ contentë¥¼ historyì— ì¶”ê°€
  history.push({
    content: message.content,
    createdAt: message.createdAt.toISOString(),
  });
  
  // ìƒˆ contentë¡œ ì—…ë°ì´íŠ¸
  return prisma.message.update({
    where: { id: messageId },
    data: {
      content: newContent,
      history,
    },
  });
}
```

### 4.4 Message.context í•„ë“œ ìƒì„¸ (RAG ëŒ€ë¹„)

**ë°ì´í„° êµ¬ì¡° (ì˜ˆì‹œ)**:

```typescript
// types/database.ts
interface MessageContext {
  sources?: {
    id: string;
    title: string;
    url?: string;
    relevanceScore: number;
  }[];
  embeddings?: number[];
  metadata?: Record<string, unknown>;
}
```

> **Note**: MVPì—ì„œëŠ” `context` í•„ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, í–¥í›„ RAG ê¸°ëŠ¥ êµ¬í˜„ ì‹œ í™œìš©í•œë‹¤.

### 4.5 ì ‘ê·¼ ì œì–´ ì •ì±…

> **Note**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ `withAuth` ë¯¸ë“¤ì›¨ì–´ì™€ Prisma ì¿¼ë¦¬ë¥¼ í™œìš©í•œ ì ‘ê·¼ ì œì–´ë¥¼ êµ¬í˜„í•œë‹¤.

**ì ‘ê·¼ ì œì–´ ì „ëµ**:

| ë¦¬ì†ŒìŠ¤ | ì ‘ê·¼ ê·œì¹™ | êµ¬í˜„ ë°©ì‹ |
|--------|----------|----------|
| `users` | ë³¸ì¸ ë°ì´í„°ë§Œ ì¡°íšŒ/ìˆ˜ì • ê°€ëŠ¥ | `withAuth` ë¯¸ë“¤ì›¨ì–´ |
| `conversations` | ë³¸ì¸ì´ ìƒì„±í•œ ëŒ€í™”ë§Œ ì ‘ê·¼ ê°€ëŠ¥ | `userId` í•„í„°ë§ ì¿¼ë¦¬ |
| `messages` | ë³¸ì¸ ëŒ€í™” ë‚´ ë©”ì‹œì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥ | `conversation.userId` ê²€ì¦ |
| `tokenUsage` | ë³¸ì¸ ì‚¬ìš©ëŸ‰ë§Œ ì¡°íšŒ ê°€ëŠ¥ | `userId` í•„í„°ë§ ì¿¼ë¦¬ |

---

## 5. ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ê°€ì´ë“œ

### 5.1 Auth Middleware (withAuth)

ëª¨ë“  API Routeì™€ Server Actionì„ ë³´í˜¸í•˜ê¸° ìœ„í•œ ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´ì„ ë„ì…í•œë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `lib/auth/middleware.ts`

```typescript
import { auth } from '@/lib/auth';
import { NextResponse } from 'next/server';

type AuthenticatedHandler = (
  req: Request,
  userId: string,
  context?: { params: Record<string, string> }
) => Promise<Response>;

/**
 * API Routeë¥¼ ì¸ì¦ìœ¼ë¡œ ë³´í˜¸í•˜ëŠ” HOF (Higher-Order Function)
 * 
 * ì‚¬ìš© ì˜ˆì‹œ:
 * export const POST = withAuth(async (req, userId) => { ... });
 */
export function withAuth(handler: AuthenticatedHandler) {
  return async (req: Request, context?: { params: Record<string, string> }) => {
    const session = await auth();
    
    if (!session?.user?.id) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }
    
    return handler(req, session.user.id, context);
  };
}

/**
 * Server Actionìš© ì¸ì¦ ê²€ì¦ í•¨ìˆ˜
 * 
 * ì‚¬ìš© ì˜ˆì‹œ:
 * const userId = await requireAuth();
 */
export async function requireAuth(): Promise<string> {
  const session = await auth();
  
  if (!session?.user?.id) {
    throw new Error('Unauthorized');
  }
  
  return session.user.id;
}
```

**API Route ì ìš© ì˜ˆì‹œ**:

```typescript
// app/api/conversations/route.ts
import { withAuth } from '@/lib/auth/middleware';
import { prisma } from '@/lib/prisma/client';

export const GET = withAuth(async (req, userId) => {
  const conversations = await prisma.conversation.findMany({
    where: { userId },
    orderBy: { updatedAt: 'desc' },
  });
  
  return Response.json(conversations);
});

export const POST = withAuth(async (req, userId) => {
  const { title, model } = await req.json();
  
  const conversation = await prisma.conversation.create({
    data: { userId, title, model },
  });
  
  return Response.json(conversation, { status: 201 });
});
```

**Server Action ì ìš© ì˜ˆì‹œ**:

```typescript
// app/actions/conversations.ts
'use server';

import { requireAuth } from '@/lib/auth/middleware';
import { prisma } from '@/lib/prisma/client';

export async function deleteConversation(id: string) {
  const userId = await requireAuth();
  
  // ê¶Œí•œ ê²€ì¦
  const conversation = await prisma.conversation.findUnique({
    where: { id },
    select: { userId: true },
  });
  
  if (conversation?.userId !== userId) {
    throw new Error('Forbidden');
  }
  
  await prisma.conversation.delete({ where: { id } });
  
  return { success: true };
}
```

### 5.2 Model Abstraction (AVAILABLE_MODELS)

ì¶”í›„ ë©€í‹° ëª¨ë¸ í™•ì¥ì„ ëŒ€ë¹„í•˜ì—¬ ëª¨ë¸ ì •ë³´ë¥¼ ìƒìˆ˜ë¡œ ê´€ë¦¬í•œë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `lib/constants/models.ts`

```typescript
export interface ModelConfig {
  id: string;           // API í˜¸ì¶œ ì‹œ ì‚¬ìš©
  name: string;         // UI í‘œì‹œëª…
  provider: 'openai' | 'anthropic' | 'google';
  maxTokens: number;    // ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš°
  badge?: string;       // UI ë±ƒì§€ (ì˜ˆ: "ë¹ ë¦„", "ì¶”ì²œ")
  description?: string; // íˆ´íŒ ì„¤ëª…
  enabled: boolean;     // MVPì—ì„œ í™œì„±í™” ì—¬ë¶€
}

export const AVAILABLE_MODELS: ModelConfig[] = [
  {
    id: 'gpt-4o-mini',
    name: 'GPT-4o Mini',
    provider: 'openai',
    maxTokens: 128000,
    badge: 'ì¶”ì²œ',
    description: 'ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ë²”ìš© ëª¨ë¸',
    enabled: true,
  },
  {
    id: 'gpt-4o',
    name: 'GPT-4o',
    provider: 'openai',
    maxTokens: 128000,
    badge: 'ê³ ê¸‰',
    description: 'ìµœê³  ì„±ëŠ¥ì˜ ë©€í‹°ëª¨ë‹¬ ëª¨ë¸',
    enabled: true,
  },
  {
    id: 'gpt-4-turbo',
    name: 'GPT-4 Turbo',
    provider: 'openai',
    maxTokens: 128000,
    description: 'ë¹„ìš© íš¨ìœ¨ì ì¸ ê³ ì„±ëŠ¥ ëª¨ë¸',
    enabled: true,
  },
  // Post-MVP: ë‹¤ë¥¸ í”„ë¡œë°”ì´ë” ì¶”ê°€ ì˜ˆì •
  // {
  //   id: 'claude-3-5-sonnet',
  //   name: 'Claude 3.5 Sonnet',
  //   provider: 'anthropic',
  //   maxTokens: 200000,
  //   enabled: false,
  // },
] as const;

export const DEFAULT_MODEL = 'gpt-4o-mini';

// í™œì„±í™”ëœ ëª¨ë¸ë§Œ í•„í„°ë§
export const getEnabledModels = () => 
  AVAILABLE_MODELS.filter(m => m.enabled);

// ëª¨ë¸ IDë¡œ ì„¤ì • ì¡°íšŒ
export const getModelConfig = (id: string) => 
  AVAILABLE_MODELS.find(m => m.id === id);
```

**ëª¨ë¸ë³„ í† í° í•œê³„ ì¡°íšŒ ìœ í‹¸ë¦¬í‹°**:

```typescript
// lib/utils/tokens.ts
import { getModelConfig, DEFAULT_MODEL } from '@/lib/constants/models';

export function getMaxTokensForModel(modelId: string): number {
  const config = getModelConfig(modelId);
  return config?.maxTokens ?? getModelConfig(DEFAULT_MODEL)!.maxTokens;
}
```

### 5.3 NextAuth.js ì„¤ì • (GitHub OAuth ì „ìš©)

**íŒŒì¼ ìœ„ì¹˜**: `lib/auth/index.ts`

```typescript
import NextAuth from 'next-auth';
import GitHub from 'next-auth/providers/github';
import { PrismaAdapter } from '@auth/prisma-adapter';
import { prisma } from '@/lib/prisma/client';

export const { handlers, auth, signIn, signOut } = NextAuth({
  adapter: PrismaAdapter(prisma),
  providers: [
    GitHub({
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    }),
  ],
  callbacks: {
    session: ({ session, user }) => ({
      ...session,
      user: {
        ...session.user,
        id: user.id,
      },
    }),
  },
  pages: {
    signIn: '/login',
  },
});
```

**API Route Handler**: `app/api/auth/[...nextauth]/route.ts`

```typescript
import { handlers } from '@/lib/auth';

export const { GET, POST } = handlers;
```

### 5.4 ê´€ë¦¬ì í‚¤ ê´€ë¦¬ ì•„í‚¤í…ì²˜

**êµ¬ì„± ìš”ì†Œ**:
- Admin UI: `app/(admin)/...` í˜ì´ì§€ë“¤, shadcn/ui ê¸°ë°˜
- Admin API: `app/api/admin/...` ë¼ìš°íŠ¸ (í‚¤ CRUD, ì‚¬ìš©/ê°ì‚¬ ë¡œê·¸)
- Service ë ˆì´ì–´: `lib/crypto/`(AES-GCM), `lib/api-keys/`(í‚¤ ì¡°íšŒ/ìºì‹œ/ë¬´íš¨í™”)
- ì €ì¥ì†Œ: Prisma ëª¨ë¸(ApiKey, ApiKeyUsage, AdminAuditLog)

**ë™ì‘ íë¦„**:
- í‚¤ ìƒì„±/ìˆ˜ì •/ì‚­ì œ â†’ ì•”í˜¸í™” ì €ì¥ â†’ ê°ì‚¬ ë¡œê·¸ ê¸°ë¡ â†’ ìºì‹œ ë¬´íš¨í™” ì´ë²¤íŠ¸
- ì±„íŒ… API í˜¸ì¶œ ì‹œ â†’ í™œì„± í‚¤ ìºì‹œ ì¡°íšŒ(ì—†ìœ¼ë©´ DB ì¡°íšŒ) â†’ í”„ë¡œë°”ì´ë” SDK ì´ˆê¸°í™” â†’ ì‚¬ìš© ë¡œê·¸ ê¸°ë¡ â†’ ë§ˆì§€ë§‰ ì‚¬ìš©/ì¹´ìš´íŠ¸ ê°±ì‹ 

**ë³´ì•ˆ/ìš´ì˜**:
- í‚¤ ì›ë¬¸ì€ ì„œë²„ ë©”ëª¨ë¦¬/ì „ì†¡ì—ë§Œ ì¡´ì¬, UI/ë¡œê·¸ì— ë…¸ì¶œ ê¸ˆì§€
- `API_KEY_ENCRYPTION_KEY`(32ë°”ì´íŠ¸)ë¡œ AES-256-GCM, í‚¤ ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸ ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ì ìš©
- ì¬ì‹œì‘ ì—†ì´ ë°˜ì˜: ìºì‹œ ë¬´íš¨í™”ì™€ ì¦‰ì‹œ ì¡°íšŒë¡œ ë³´ì¥

**ë¡œê·¸ì¸ í˜ì´ì§€**: `app/(auth)/login/page.tsx`

```typescript
import { signIn } from '@/lib/auth';
import { Button } from '@/components/ui/button';
import { Github } from 'lucide-react';

export default function LoginPage() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <div className="w-full max-w-sm space-y-6 p-8">
        <div className="text-center">
          <h1 className="text-2xl font-bold">MyLukeAI</h1>
          <p className="text-muted-foreground mt-2">ë¡œê·¸ì¸í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
        </div>
        
        <form
          action={async () => {
            'use server';
            await signIn('github', { redirectTo: '/' });
          }}
        >
          <Button type="submit" className="w-full" size="lg">
            <Github className="mr-2 h-5 w-5" />
            GitHubë¡œ ë¡œê·¸ì¸
          </Button>
        </form>
      </div>
    </div>
  );
}
```

---

## 6. í”„ë¡œì íŠ¸ êµ¬ì¡° (Project Structure)

```
mylukeai/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/                   # ì¸ì¦ ê´€ë ¨ ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”‚   â””â”€â”€ login/page.tsx        # GitHub OAuth ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ (main)/                   # ë©”ì¸ ì•± ë¼ìš°íŠ¸ ê·¸ë£¹
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ì‚¬ì´ë“œë°” í¬í•¨ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # í™ˆ (ìƒˆ ì±„íŒ… + Empty State)
â”‚   â”‚   â”‚   â””â”€â”€ c/[id]/page.tsx       # ê°œë³„ ì±„íŒ…ë°©
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/route.ts  # NextAuth.js í•¸ë“¤ëŸ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/route.ts         # AI ì±„íŒ… ìŠ¤íŠ¸ë¦¬ë°
â”‚   â”‚   â”‚   â””â”€â”€ conversations/        # ëŒ€í™” CRUD API
â”‚   â”‚   â”‚       â”œâ”€â”€ route.ts          # GET (ëª©ë¡), POST (ìƒì„±)
â”‚   â”‚   â”‚       â””â”€â”€ [id]/route.ts     # GET, PATCH, DELETE
â”‚   â”‚   â”‚       
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/                 # ê´€ë¦¬ì í‚¤ ê´€ë¦¬ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ keys/route.ts      # ëª©ë¡/ìƒì„±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ keys/[id]/route.ts # ìˆ˜ì •/ì‚­ì œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ keys/stats/route.ts# ì‚¬ìš©ëŸ‰ ìš”ì•½
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audit-logs/route.ts# ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ actions/                  # Server Actions
â”‚   â”‚   â”‚   â””â”€â”€ conversations.ts
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                       # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tooltip.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ chat/                     # ì±„íŒ… ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatArea.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatBubble.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx        # v1.2 ì¶”ê°€
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageActions.tsx    # ë³µì‚¬, ì¬ìƒì„± ë²„íŠ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ ModelSelector.tsx     # v1.2 ì¶”ê°€
â”‚   â”‚   â”‚   â”œâ”€â”€ TokenCounter.tsx      # v1.2 ê°œì„ 
â”‚   â”‚   â”‚   â””â”€â”€ VersionDropdown.tsx   # ì´ì „ ë²„ì „ ë³´ê¸°
â”‚   â”‚   â”œâ”€â”€ layout/                   # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CommandPalette.tsx
â”‚   â”‚   â””â”€â”€ shared/                   # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚       â”œâ”€â”€ ErrorBoundary.tsx
â”‚   â”‚       â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚       â””â”€â”€ Toast.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                       # Zustand ìŠ¤í† ì–´
â”‚   â”‚   â”œâ”€â”€ chatStore.ts
â”‚   â”‚   â”œâ”€â”€ uiStore.ts                # ì‚¬ì´ë“œë°” ìƒíƒœ, í…Œë§ˆ ë“±
â”‚   â”‚   â””â”€â”€ settingsStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                        # ê³µí†µ ì»¤ìŠ¤í…€ í›…
â”‚   â”‚   â”œâ”€â”€ useKeyboardShortcuts.ts
â”‚   â”‚   â”œâ”€â”€ useTokenCount.ts
â”‚   â”‚   â””â”€â”€ useMediaQuery.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                          # ìœ í‹¸ë¦¬í‹° & ì™¸ë¶€ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts             # Prisma í´ë¼ì´ì–¸íŠ¸ ì‹±ê¸€í†¤
â”‚   â”‚   â”‚   â””â”€â”€ queries.ts            # ê³µí†µ DB ì¿¼ë¦¬ í•¨ìˆ˜
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts              # NextAuth.js ì„¤ì •
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts         # withAuth, requireAuth
â”‚   â”‚   â”‚   â””â”€â”€ admin.ts              # withAdmin, requireAdmin
â”‚   â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”‚   â”œâ”€â”€ models.ts             # AVAILABLE_MODELS
â”‚   â”‚   â”‚   â””â”€â”€ prompts.ts            # EXAMPLE_PROMPTS
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ api-keys.ts           # í‚¤ ìºì‹œ/ë¬´íš¨í™”/ì¡°íšŒ
â”‚   â”‚       â””â”€â”€ crypto.ts             # AES-GCM ì•”í˜¸í™”/ë³µí˜¸í™”
â”‚   â”‚       â”œâ”€â”€ cn.ts                 # clsx + tailwind-merge
â”‚   â”‚       â”œâ”€â”€ tokens.ts             # í† í° ê³„ì‚° ìœ í‹¸
â”‚   â”‚       â”œâ”€â”€ exportChat.ts         # ë‚´ë³´ë‚´ê¸° ë¡œì§
â”‚   â”‚       â””â”€â”€ formatters.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                        # ì „ì—­ íƒ€ì… ì •ì˜
â”‚       â”œâ”€â”€ chat.ts
â”‚       â”œâ”€â”€ database.ts               # MessageHistory, MessageContext ë“±
â”‚       â””â”€â”€ api.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma                 # ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ migrations/                   # DB ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬
â”‚   â””â”€â”€ seed.ts                       # ì´ˆê¸° ì‹œë“œ ë°ì´í„° (ì„ íƒ)
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ icons/
â”‚
â”œâ”€â”€ .env.local.example
â”œâ”€â”€ biome.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## 7. ê°œë°œ ë¡œë“œë§µ (Phase 1: MVP)

### 7.1 ìŠ¤í”„ë¦°íŠ¸ ê³„íš (2ì£¼ MVP, v1.2 ìˆ˜ì •)

#### Week 1: í•µì‹¬ ì¸í”„ë¼ + ê¸°ë³¸ ì±„íŒ…

| Day | íƒœìŠ¤í¬ | ì‚°ì¶œë¬¼ | ì˜ˆìƒ ì‹œê°„ |
|-----|--------|--------|----------|
| 1 | í”„ë¡œì íŠ¸ ì´ˆê¸°í™”, shadcn/ui ì„¤ì •, PostgreSQL + Prisma ì„¤ì • | ë¹ˆ í”„ë¡œì íŠ¸ ì‹¤í–‰, DB ì—°ê²° í™•ì¸ | 4h |
| 1 | GitHub OAuth ì„¤ì • (NextAuth.js) | ë¡œê·¸ì¸ ë™ì‘ í™•ì¸ | 2h |
| 2 | ë ˆì´ì•„ì›ƒ êµ¬í˜„ (ì‚¬ì´ë“œë°”, í—¤ë”, ì±„íŒ… ì˜ì—­) | ê¸°ë³¸ UI ê»ë°ê¸° | 6h |
| 3 | withAuth ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„ + Empty State UI | ì¸ì¦ ë³´í˜¸, ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ë²„íŠ¼ | 4h |
| 3 | ê¸°ë³¸ ì±„íŒ… API + ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„ | AIì™€ ëŒ€í™” ê°€ëŠ¥ | 4h |
| 4 | Stop Generating ê¸°ëŠ¥ êµ¬í˜„ | ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ë™ì‘ | 2h |
| 4 | Markdown ë Œë”ë§, ì½”ë“œ í•˜ì´ë¼ì´íŒ… | ì½”ë“œ ë¸”ë¡ í‘œì‹œ | 3h |
| 5 | ì±„íŒ… íˆìŠ¤í† ë¦¬ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (Prisma ì¿¼ë¦¬) | ëŒ€í™” ëª©ë¡ ë™ì‘ | 5h |

#### Week 2: í•„ìˆ˜ ê¸°ëŠ¥ + ì•ˆì •í™”

| Day | íƒœìŠ¤í¬ | ì‚°ì¶œë¬¼ | ì˜ˆìƒ ì‹œê°„ |
|-----|--------|--------|----------|
| 6 | ì—ëŸ¬/ë¡œë”© ìƒíƒœ ì²˜ë¦¬, í† ìŠ¤íŠ¸ ì•Œë¦¼ | ì•ˆì •ì ì¸ ì—ëŸ¬ UX | 5h |
| 7 | ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ, ë°˜ì‘í˜• ëª¨ë°”ì¼ (dvh ì ìš©) | í…Œë§ˆ ë° ëª¨ë°”ì¼ ëŒ€ì‘ | 4h |
| 7 | í† í° ì¹´ìš´í„° (ê°œì„ ëœ UX) | ì§ê´€ì  ë‚¨ì€ ëŒ€í™”ëŸ‰ í‘œì‹œ | 2h |
| 8 | ì‘ë‹µ ì¬ìƒì„± + Message.history ê´€ë¦¬ | P1 ê¸°ëŠ¥ ì™„ë£Œ | 4h |
| 8 | ëª¨ë¸ ì…€ë ‰í„° (AVAILABLE_MODELS ê¸°ë°˜) | ëª¨ë¸ ì„ íƒ ê°€ëŠ¥ | 2h |
| 9 | í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Cmd+K, Cmd+Enter ë“±) | UX ê°œì„  | 3h |
| 9 | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§• | ì„¤ì • ê°€ëŠ¥ | 2h |
| 10 | ëŒ€í™” ë‚´ë³´ë‚´ê¸° (Markdown) | P1 ê¸°ëŠ¥ ì™„ë£Œ | 3h |
| 10 | ê´€ë¦¬ì í‚¤ ê´€ë¦¬(UI+API+ì•”í˜¸í™”) | í‚¤ CRUD/ë¡œê·¸/ë°˜ì˜ | 6h |

#### Buffer (2-3ì¼)

| íƒœìŠ¤í¬ | ì˜ˆìƒ ì‹œê°„ |
|--------|----------|
| ë²„ê·¸ ìˆ˜ì • ë° í´ë¦¬ì‹± | 4h |
| Vercel ë°°í¬ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì • | 2h |
| Docker Compose ë¡œì»¬ ê°œë°œ í™˜ê²½ êµ¬ì„± | 2h |
| README ë¬¸ì„œí™” | 2h |

### 7.2 ì™„ë£Œ ê¸°ì¤€ (Definition of Done)

MVPê°€ "ì™„ë£Œ"ë¡œ ê°„ì£¼ë˜ë ¤ë©´ ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•´ì•¼ í•œë‹¤:

- [ ] **GitHub OAuthë¡œ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê°€ëŠ¥**
- [ ] ìƒˆ ì±„íŒ… ìƒì„± ë° AIì™€ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ëŒ€í™” ê°€ëŠ¥
- [ ] **Empty Stateì—ì„œ ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ í´ë¦­ ì‹œ ëŒ€í™” ì‹œì‘**
- [ ] **ìŠ¤íŠ¸ë¦¬ë° ì¤‘ "ìƒì„± ì¤‘ì§€" ë²„íŠ¼ìœ¼ë¡œ ì¤‘ë‹¨ ê°€ëŠ¥**
- [ ] ëŒ€í™” íˆìŠ¤í† ë¦¬ê°€ ì €ì¥ë˜ê³  ì¬ë°©ë¬¸ ì‹œ ë¶ˆëŸ¬ì™€ì§
- [ ] Markdown/ì½”ë“œ ë¸”ë¡ì´ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ë¨
- [ ] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- [ ] ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜ ê°€ëŠ¥
- [ ] ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ì •ìƒ ë™ì‘ (dvh ì ìš©)
- [ ] ì‘ë‹µ ì¬ìƒì„± ê¸°ëŠ¥ ë™ì‘ (history í•„ë“œì— ì´ì „ ë²„ì „ ì €ì¥)
- [ ] **í† í° ì¹´ìš´í„°ê°€ "ë‚¨ì€ ëŒ€í™”ëŸ‰"ìœ¼ë¡œ ì§ê´€ì  í‘œì‹œ**
- [ ] **ëª¨ë¸ ì…€ë ‰í„°ì—ì„œ AI ëª¨ë¸ ì„ íƒ ê°€ëŠ¥**
- [ ] ëŒ€í™”ë¥¼ Markdownìœ¼ë¡œ ë‚´ë³´ë‚´ê¸° ê°€ëŠ¥
- [ ] **ëª¨ë“  API Routeì— withAuth ë¯¸ë“¤ì›¨ì–´ ì ìš©**
- [ ] Vercelì— ë°°í¬ë˜ì–´ ì™¸ë¶€ ì ‘ê·¼ ê°€ëŠ¥
- [ ] **ê´€ë¦¬ì í‚¤ ê´€ë¦¬ UI/APIê°€ ë™ì‘í•˜ê³  ë³€ê²½ì´ ì¦‰ì‹œ ë°˜ì˜ë¨**
- [ ] **í‚¤ê°€ DBì— ì•”í˜¸í™” ì €ì¥ë˜ê³  ê°ì‚¬/ì‚¬ìš© ë¡œê·¸ê°€ ê¸°ë¡ë¨**

---

## 8. Post-MVP ë¡œë“œë§µ

### 8.1 v1.1 ë¦´ë¦¬ìŠ¤ (Privacy Mode)

| ê¸°ëŠ¥ | ì„¤ëª… | ì˜ˆìƒ ê³µìˆ˜ |
|------|------|----------|
| Privacy Mode í•µì‹¬ | IndexedDB ë¡œì»¬ ì €ì¥, ì„œë²„ ë¯¸ì „ì†¡ | 3ì¼ |
| ìµëª… í† í° ì¶”ì  | userId ì—†ì´ í† í° ì‚¬ìš©ëŸ‰ë§Œ ìˆ˜ì§‘ | 1ì¼ |
| UI í† ê¸€ | ëª¨ë“œ ì „í™˜ UI ë° ì•ˆë‚´ ë¬¸êµ¬ | 1ì¼ |
| ë™ê¸°í™” ë¶ˆê°€ ì•ˆë‚´ | ë‹¤ë¥¸ ê¸°ê¸° ì ‘ê·¼ ë¶ˆê°€ ëª…ì‹œ | 0.5ì¼ |

### 8.2 v1.2 ë¦´ë¦¬ìŠ¤ (ë©€í‹° í”„ë¡œë°”ì´ë”)

| ê¸°ëŠ¥ | ì„¤ëª… | ì˜ˆìƒ ê³µìˆ˜ |
|------|------|----------|
| Anthropic Claude ì§€ì› | Claude 3.5 Sonnet ë“± | 2ì¼ |
| Google Gemini ì§€ì› | Gemini Pro ë“± | 2ì¼ |
| í”„ë¡œë°”ì´ë”ë³„ API Key ê´€ë¦¬ | ì‚¬ìš©ì ì„¤ì •ì— ì €ì¥ | 1ì¼ |

### 8.3 v2.0 ë¦´ë¦¬ìŠ¤ (RAG)

| ê¸°ëŠ¥ | ì„¤ëª… | ì˜ˆìƒ ê³µìˆ˜ |
|------|------|----------|
| ë¬¸ì„œ ì—…ë¡œë“œ | PDF, TXT, MD íŒŒì¼ ì²˜ë¦¬ | 3ì¼ |
| ì„ë² ë”© ìƒì„± | OpenAI Embeddings API | 2ì¼ |
| ë²¡í„° ê²€ìƒ‰ | pgvector ë˜ëŠ” Pinecone | 3ì¼ |
| Message.context í™œìš© | RAG ì†ŒìŠ¤ í‘œì‹œ | 1ì¼ |

---

## ë¶€ë¡ A: í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿

```env
# .env.local

# Database (PostgreSQL)
DATABASE_URL="postgresql://user:password@localhost:5432/mylukeai?schema=public"

# NextAuth.js
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-here  # openssl rand -base64 32 ë¡œ ìƒì„±

# GitHub OAuth (í•„ìˆ˜)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# OpenAI (ë˜ëŠ” ë‹¤ë¥¸ LLM)
OPENAI_API_KEY=sk-xxx...

# Optional: Analytics
NEXT_PUBLIC_VERCEL_ANALYTICS_ID=xxx

# Admin Key Management Encryption
API_KEY_ENCRYPTION_KEY=base64-encoded-32-byte-key
```

**GitHub OAuth ì•± ì„¤ì • ë°©ë²•**:
1. GitHub â†’ Settings â†’ Developer settings â†’ OAuth Apps â†’ New OAuth App
2. Application name: `MyLukeAI (Local)`
3. Homepage URL: `http://localhost:3000`
4. Authorization callback URL: `http://localhost:3000/api/auth/callback/github`
5. Client IDì™€ Client Secretì„ `.env.local`ì— ë³µì‚¬

**Docker Compose ë¡œì»¬ ê°œë°œ í™˜ê²½** (ì„ íƒ):

```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: mylukeai
      POSTGRES_PASSWORD: localdev
      POSTGRES_DB: mylukeai
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

---

## ë¶€ë¡ B: ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì¸í„°í˜ì´ìŠ¤ (v1.2 ìˆ˜ì •)

### ChatInput Props

```typescript
interface ChatInputProps {
  onSend: (message: string) => void;
  isStreaming: boolean;
  onStop: () => void;       // Stop Generating í•¸ë“¤ëŸ¬
  disabled?: boolean;
  placeholder?: string;
}
```

### ChatBubble Props

```typescript
interface ChatBubbleProps {
  message: Message;
  isStreaming?: boolean;
  onRegenerate?: () => void;
  onCopy?: () => void;
  history?: MessageHistory[];  // v1.2: ë³„ë„ í…Œì´ë¸” ëŒ€ì‹  Json í•„ë“œ
  onVersionChange?: (index: number) => void;
}
```

### Message Type

```typescript
interface Message {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  tokens?: number;
  history?: MessageHistory[];  // v1.2: ì´ì „ ë²„ì „ ë°°ì—´
  context?: MessageContext;    // v1.2: RAG ëŒ€ë¹„
  createdAt: Date;
}

interface MessageHistory {
  content: string;
  createdAt: string;  // ISO 8601
}

interface MessageContext {
  sources?: {
    id: string;
    title: string;
    url?: string;
    relevanceScore: number;
  }[];
  embeddings?: number[];
  metadata?: Record<string, unknown>;
}
```

### EmptyState Props (v1.2 ì¶”ê°€)

```typescript
interface EmptyStateProps {
  onPromptClick: (prompt: string) => void;
}
```

### TokenCounter Props (v1.2 ê°œì„ )

```typescript
interface TokenCounterProps {
  usedTokens: number;
  maxTokens: number;
}
```

### ModelSelector Props (v1.2 ì¶”ê°€)

```typescript
interface ModelSelectorProps {
  value: string;
  onChange: (modelId: string) => void;
}
```

---

## ë¶€ë¡ C: Prisma í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

```typescript
// lib/prisma/client.ts
import { PrismaClient } from '@prisma/client';

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma =
  globalForPrisma.prisma ??
  new PrismaClient({
    log: process.env.NODE_ENV === 'development' 
      ? ['query', 'error', 'warn'] 
      : ['error'],
  });

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma;
}
```

---

## ë¶€ë¡ D: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ëª©ë¡

| ë‹¨ì¶•í‚¤ | ë™ì‘ | ì»¨í…ìŠ¤íŠ¸ |
|--------|------|---------|
| `Cmd/Ctrl + K` | Command Palette ì—´ê¸° | ì „ì—­ |
| `Cmd/Ctrl + Enter` | ë©”ì‹œì§€ ì „ì†¡ | ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì‹œ |
| `Cmd/Ctrl + Shift + C` | ë§ˆì§€ë§‰ AI ì‘ë‹µ ë³µì‚¬ | ì±„íŒ… ì˜ì—­ |
| `Cmd/Ctrl + N` | ìƒˆ ì±„íŒ… ìƒì„± | ì „ì—­ |
| `Cmd/Ctrl + /` | ì‚¬ì´ë“œë°” í† ê¸€ | ì „ì—­ |
| `Esc` | ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ / ëª¨ë‹¬ ë‹«ê¸° | ìŠ¤íŠ¸ë¦¬ë° ì¤‘ |

---

**ë¬¸ì„œ ë**

> ì´ ëª…ì„¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ ë¶ˆëª…í™•í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´, ì½”ë“œ ì‘ì„± ì „ì— ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”. ëª…ì„¸ì„œê°€ í‹€ë¦¬ë©´ ê³ ì¹˜ëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤.
â”‚   â”‚   â”œâ”€â”€ admin/                     # ê´€ë¦¬ì UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ApiKeyManager.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AdminSidebar.tsx
â”‚   â”‚
